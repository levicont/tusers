<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
xmlns:beans="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/security
		http://www.springframework.org/schema/security/spring-security.xsd">
	
	<http>	
		<intercept-url pattern="/**" requires-channel="https"/>
		<port-mappings>
			<port-mapping http="8080" https="8443"/>
		</port-mappings>
		
		<intercept-url pattern="/signin" access="permitAll()"/>
		<intercept-url pattern="/files/**" access="permitAll()"/>
		<intercept-url pattern="/home" access="hasRole('ROLE_USER')"/>
		<intercept-url pattern="/img" access="hasRole('ROLE_USER')"/>
		<intercept-url pattern="/" access="hasRole('ROLE_USER')"/>
		
		<form-login login-page='/signin'
		 default-target-url="/"
		 always-use-default-target="true"
		 username-parameter="email"
		 password-parameter="password"
		 authentication-failure-url="/signin?error=true"
		 login-processing-url="/signin"/>
		 <remember-me 
		 	remember-me-parameter="remember-me"		 	
		 	data-source-ref="dataSource"
		 	/>
		 <logout
		 	delete-cookies="remember-me"
		 	logout-url="/logout"
		 	logout-success-url="/"
		 />
		<csrf/>
	</http>
	
	
	<authentication-manager>		
		<authentication-provider>
			<password-encoder ref="bcrypt"/>			
			<jdbc-user-service data-source-ref="dataSource" 
				users-by-username-query="SELECT email, password, 'true' FROM tusers.user WHERE email=?"
				authorities-by-username-query="SELECT email, 'ROLE_USER' FROM tusers.user WHERE email=?"
				/>
			<!-- user-service >			
				<user name="mike" password="1" authorities="ROLE_USER"/>
			</user-service-->
		</authentication-provider>
	</authentication-manager>
	
	<beans:bean id="bcrypt" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder">
		<beans:constructor-arg name="strength" value="11"/>
	</beans:bean>
	
</beans:beans>